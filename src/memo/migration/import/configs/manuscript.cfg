[transmogrifier]
include = memo_migration_base
pipeline -=
  title_to_id
  generate_path
  constructor
  schemaupdater
  logger
pipeline +=
  newtitle
  title_to_id
  generate_path
  constructor
  schemaupdater
  librelater
  logger

[jsonsource]
tables = ['${definitions:table_prefix}manuscript']

[portal_type]
value = string:Manuscript

[setsqlid]
idfield =  manuscript_id

[foldering]
value = string:${definitions:path_prefix}/manuscripts

[addLiterature]
blueprint = ploneconf.subtable
path = memoDBJson
tables = ['${definitions:table_prefix}manuscript_literature']
linkinField = manuscript_id
targetField = literature
valueField = text

[newtitle]
blueprint = collective.transmogrifier.sections.inserter
key = string:title
value = string:mId-${item/manuscript_id}/lId-${item/library_id}
condition = python:'title' not in item

[librelater]
blueprint = ploneconf.referenceupdater
sqlIdField = library_id
referenceFieldname = library
